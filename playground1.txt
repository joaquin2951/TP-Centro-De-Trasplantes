|centro evaluador don2 pac pac2 pac3 don resultado|

Transcript clear; show:'EJEMPLO 1'; cr.
"============================================" 
"CREAR EL CENTRO DE TRASPLANTES" 
"============================================" 
centro := CentroTransplantes conNombre: 'Hospital Iturraspe'.


"============================================" 
"REGISTRAR PERSONAS" 
"============================================"

"Pacientes"
pac := Persona conDni: '44575945' nombre: 'Joaquin' apellido: 'Hernandez'  fechaNacimiento: (Date newDay: 29 month: 12 year: 2003).
pac2 := Persona conDni: '33956842' nombre: 'Lionel' apellido: 'Aguero'  fechaNacimiento: (Date newDay: 10 month: 1 year: 1990).
pac3 := Persona conDni: '30105233' nombre: 'Fabian' apellido: 'Cantilo'  fechaNacimiento: (Date newDay: 1 month: 5 year: 1978).

"Donantes"
don := Persona conDni: '48234999' nombre: 'Eze	quiel' apellido: 'Loza'  fechaNacimiento: (Date newDay: 6 month: 7 year: 2010).
don2 := Persona conDni: '50565112' nombre: 'Luis' apellido: 'Fonsi'  fechaNacimiento: (Date newDay: 3 month: 10 year: 2019).

"agrego pacientes y donantes al centro"
centro agregaPaciente: pac fechaIngreso: (Date newDay: 1 month:10  year:2025 ).
centro agregaPaciente: pac2 fechaIngreso: (Date newDay: 5 month:4  year:2022 ).
centro agregaPaciente: pac3 fechaIngreso: (Date newDay: 1 month:1  year:2015 ).

centro agregaDonante: don.
centro agregaDonante: don2.

"asocio pacientes con donantes registrados"
centro asociaPaciente: pac conDonante: don2.
centro asociaPaciente: pac2 conDonante: don.


"============================================" 
"CREAR Y REGISTRAR ESTUDIOS CLÍNICOS" 
"============================================"  

"Datos de estatura y talla: tamaño corporal"
pac estatura: 1.75 ; peso: 70.
pac2 estatura: 2.0 ; peso: 85.
don estatura: 1.80; peso: 82.

"Estudio Analisis de Sangre"
pac registraEstudio: (AnalisisDeSangre conGrupoSanguineo: #B).
pac2 registraEstudio: (AnalisisDeSangre conGrupoSanguineo: #AB).
don registraEstudio: (AnalisisDeSangre conGrupoSanguineo: #B).

"Estudio Crossmatch"
pac registraEstudio: (EstudioCrossMatch conResultado: #negativo) con: don.
pac2 registraEstudio: (EstudioCrossMatch conResultado: #positivo) con: don.

"Estudio Serologico"
pac registraEstudio: (EstudioSerologicoCompleto conResultado: #apto).
pac2 registraEstudio: (EstudioSerologicoCompleto conResultado: #noApto).
don registraEstudio: (EstudioSerologicoCompleto conResultado: #apto).

"Estudio TipificacionHLA"

don registraEstudio: (EstudioTipificacionHLA  conA: #(A2 A3)  b: #(B7 B8)  dR:#(DR4 DR15)).

"Estudio AnticuerposPRA"
pac registraEstudio: (EstudioAnticuerposPRA conA: #(A3 15) b:#(A4 80)  dR:#(B8 10) ).

"Estudio IMC"
pac registraEstudio: (EstudioIMC paraPersona:pac).
pac2 registraEstudio: (EstudioIMC paraPersona:pac2).


"Estudio aptitud General"
pac registraEstudio: (EstudioAptitudGeneral conResultado: #apto).
pac2 registraEstudio: (EstudioAptitudGeneral conResultado: #noApto).
don registraEstudio: (EstudioAptitudGeneral conResultado: #apto).



"============================================" 
"CREAR CRITERIOS Y CONFIGURAR EL EVALUADOR" 
"============================================" 
"evaluador"
evaluador := EvaluadorCompatibilidad new.

"Agregar criterios obligatorios (si fallan, no se puede hacer el trasplante)" 
evaluador agregarCriterioObligatorio: (ABO new).
evaluador agregarCriterioObligatorio: (Crossmatch  new).
evaluador agregarCriterioObligatorio: (SerologiaActiva new).

"Agregar criterios deseables con sus ponderaciones (peso en %)" 
evaluador agregarCriterioDeseable: (HLA new) ponderacion: 80.
evaluador agregarCriterioDeseable: (Edad new) ponderacion: 10.
evaluador agregarCriterioDeseable: (TamCorporal new) ponderacion: 10. 

"asignamos un minimo para la compatibilidad"
ResultadoCompatibilidad minimoCompatibilidad: 50.
Transcript show: 'Minimo de Compatibilidad: '; show:50 ; cr.

"asignamos el evaluador al centro"
centro evaluadorCompatibilidad: evaluador.


"============================================" 
"CALCULAR COMPATIBILIDAD" 
"============================================" 

Transcript cr; show:'-------------'; cr;
			  show: 'Compatibilidad entre PAC y DON'; cr.
resultado := (centro compatibilidad: pac con: don). 

"Mostrar el resultado" 
Transcript show: 'Resultado de compatibilidad: '; show: resultado porcentajeCompatibilidad; cr.
Transcript show: 'Resultado es compatible? '; show: resultado compatible;cr.
Transcript show: 'Estudios faltantes: '; show: resultado estudiosFaltantes;cr.


Transcript cr; show:'-------------'; cr;
			  show: 'Compatibilidad entre PAC2 y DON'; cr.
resultado := (centro compatibilidad: pac2 con: don). 

"Mostrar el resultado" 
Transcript show: 'Resultado de compatibilidad: '; show: resultado porcentajeCompatibilidad; cr.
Transcript show: 'Resultado es compatible? '; show: resultado compatible; cr.
Transcript show: 'Estudios faltantes: '; show: resultado estudiosFaltantes;cr.
Transcript show: 'El motivo de compatibilidad cero en este caso es que tanto PAC2 como DON tienen los estudios pero al llegar a evaluar la compatibilidad del criterio obligatorio CROSSMATCH el resultado nos da #noApto';cr.
Transcript show: (Crossmatch new evaluaCompatibilidad: pac2 con: don);cr.



Transcript cr; show:'-------------'; cr;
			  show: 'Compatibilidad entre PAC3 y DON'; cr.
resultado := (centro compatibilidad: pac3 con: don). 

"Mostrar el resultado" 
Transcript show: 'Resultado de compatibilidad: '; show: resultado porcentajeCompatibilidad; cr.
Transcript show: 'Resultado es compatible? '; show: resultado compatible; cr.
Transcript show: 'Estudios faltantes: '; show: resultado estudiosFaltantes;cr.
Transcript show: 'El motivo de compatibilidad cero en este caso es que PAC3 no tiene los estudios que requieren los CriteriosObligatorios y por lo tanto no se puede seguir con el algoritmo, y el porcentajeCompatibilidad dara cero';cr.
"Transcript show: (ABO new evaluaCompatibilidad: pac3 con: don);cr. 
si ejectuas este mensaje de arriba, se puede comprobar (como se pedia en el enunciado) que si se trata de ejectuar evaluaCompatibilidad:con:  en un criterio cuyo paciente o donante  (o ambos) no tengan registrados los estudios correspondientes, saltará un error que te impide continuar con la ejecución del mismo"


"============================================" 
"CÁLCULOS Y GUARDAR ARCHIVOS" 
"============================================" 

"Calcular todas las compatibilidades registradas"
"
centro calculaCompatibilidadesRegistrados. 
Transcript cr; cr; show: 'Compatibilidades registradas calculadas.'; cr.

(centro compatibilidades do:[:rc |
							Transcript show:'paciente: ';
										  show: rc paciente nombre; cr.
							Transcript show:'donante: '; 
										  show: rc donante nombre; cr.
							Transcript show: 'porcentaje: '; 
										  show: rc porcentajeCompatibilidad ; cr.
							Transcript show:'compatible? ';
										  show: rc compatible; cr.
							Transcript show: 'estudios faltantes: ';
										  show: rc estudiosFaltantes.
							Transcript cr; show:'/////////'; cr;cr.
							]).
"
"Calcular todas las compatibilidades posibles" 
"centro calculaCompatibilidadesGeneral. 
Transcript show: 'Compatibilidades generales calculadas.'; cr. "

"guardar Registros"
"centro guardaRegistros: 'ejemploHospitalCentral'. 
Transcript show: 'Archivos .csv generados.'; cr."








